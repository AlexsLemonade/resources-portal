(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{866:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__(86);var asyncToGenerator=__webpack_require__(42),slicedToArray=__webpack_require__(15),regenerator=__webpack_require__(21),regenerator_default=__webpack_require__.n(regenerator),react=__webpack_require__(0),react_default=__webpack_require__.n(react),Anchor=__webpack_require__(435),Box=__webpack_require__(3),Text=__webpack_require__(16),next_link=__webpack_require__(71),link_default=__webpack_require__.n(next_link),api=(__webpack_require__(88),__webpack_require__(34),__webpack_require__(87),__webpack_require__(74)),useUser=__webpack_require__(181),ResourcesPortalContext=__webpack_require__(114),CreateAccountLoginButton=__webpack_require__(194),HeaderAccountLink_ref2=(react_default.a.createElement,react_default.a.createElement(CreateAccountLoginButton.a,{title:"Create a CCRR Portal Account"})),_ref3=react_default.a.createElement(link_default.a,{href:"/account"},react_default.a.createElement(Anchor.a,{color:"white",href:"/account/basic-information",label:"My Account"}));__webpack_exports__.default=function(){var isLoggedIn=Object(useUser.a)().isLoggedIn,_React$useState=react_default.a.useState(!1),_React$useState2=Object(slicedToArray.a)(_React$useState,2),notificationsFetched=_React$useState2[0],setNotificationsFetched=_React$useState2[1],_useNotifications=function(){var _useUser=Object(useUser.a)(),user=_useUser.user,token=_useUser.token,isLoggedIn=_useUser.isLoggedIn,_React$useContext=react_default.a.useContext(ResourcesPortalContext.a),notificationCount=_React$useContext.notificationCount,setNotificationCount=_React$useContext.setNotificationCount;return{fetchNotifications:function(){var _ref=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee(){var notificationRequest,notifications;return regenerator_default.a.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(isLoggedIn){_context.next=2;break}return _context.abrupt("return",[]);case 2:return _context.next=4,api.a.users.notifications.list(user.id,token);case 4:if(!(notificationRequest=_context.sent).isOk||!notificationRequest.response){_context.next=8;break}return notifications=notificationRequest.response.results,_context.abrupt("return",notifications);case 8:return _context.abrupt("return",[]);case 9:case"end":return _context.stop()}}),_callee)})));return function(){return _ref.apply(this,arguments)}}(),fetchNewNotifications:function(){var _ref2=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee2(){var notificationRequest,notifications;return regenerator_default.a.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(isLoggedIn){_context2.next=2;break}return _context2.abrupt("return",[]);case 2:if(!(null===user.viewed_notifications_at)){_context2.next=9;break}return _context2.next=6,api.a.users.notifications.list(user.id,token);case 6:_context2.t0=_context2.sent,_context2.next=12;break;case 9:return _context2.next=11,api.a.users.notifications.filter(user.id,{created_at__gt:user.viewed_notifications_at},token);case 11:_context2.t0=_context2.sent;case 12:if(!(notificationRequest=_context2.t0).isOk||!notificationRequest.response){_context2.next=17;break}return notifications=notificationRequest.response.results,setNotificationCount(notifications.length),_context2.abrupt("return",notifications);case 17:return _context2.abrupt("return",[]);case 18:case"end":return _context2.stop()}}),_callee2)})));return function(){return _ref2.apply(this,arguments)}}(),notificationCount:notificationCount,setNotificationCount:setNotificationCount,getLastNotificationDate:function getLastNotificationDate(notifications){var notificationDates=notifications.map((function(notification){return new Date(notification.created_at)})),lastNotifDate=new Date(Math.max.apply(null,notificationDates));return lastNotifDate.setSeconds(lastNotifDate.getSeconds()+1),lastNotifDate}}}(),notificationCount=_useNotifications.notificationCount,fetchNewNotifications=_useNotifications.fetchNewNotifications;return react_default.a.useEffect((function(){!notificationsFetched&&isLoggedIn&&function(){var _ref=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee(){return regenerator_default.a.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:fetchNewNotifications().then((function(){setNotificationsFetched(!0)}));case 1:case"end":return _context.stop()}}),_callee)})));return function(){return _ref.apply(this,arguments)}}()()})),isLoggedIn?react_default.a.createElement(Box.a,{direction:"row",gap:"small"},_ref3,0<notificationCount&&react_default.a.createElement(link_default.a,{href:"/account/notifications"},react_default.a.createElement(Box.a,{align:"center",pad:"2px",width:{min:"28px"},round:!0,background:"error"},react_default.a.createElement(Text.a,null,notificationCount)))):HeaderAccountLink_ref2}}}]);
//# sourceMappingURL=3.7279361106b10fc7277e.bundle.js.map